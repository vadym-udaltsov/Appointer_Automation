#!/usr/bin/env groovy
pipeline {
    agent any

    parameters {
        string(name: 'lambdaName', defaultValue: '', description: 'Lambda name')
        booleanParam(name: 'allLambdas', defaultValue: true, description: 'All lambdas')
        booleanParam(name: 'withLayer', defaultValue: false, description: 'Update layer')
    }

    stages {
        stage('Build') {
            steps {
                sh 'mvn clean package'
            }
        }
        stage('Deploy') {
            steps {
                script {
                    def lambdaName = "all"
                    if (!params.allLambdas) {
                        lambdaName = params.lambdaName
                    }
                    if (params.withLayer) {
                        sh "chmod +x ./updateLambdasWithLayer.sh"
                        sh './updateLambdasWithLayer.sh ' + lambdaName
                    } else {
                        sh "chmod +x ./updateOnlyLambdasCode.sh"
                        sh './updateOnlyLambdasCode.sh ' + lambdaName
                    }
                }
            }
        }
    }
}